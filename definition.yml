# ============================================================================
# Innovation Review Configuration - LOCAL TEST
# ============================================================================

# Project metadata
project:
  name: "Supplier Digital Innovation Review"
  description: "Systematic literature review on supplier involvement in digital innovation"
  researcher: "Ilja Heitlager"
  institution: "TU Eindhoven"
  email: "i.heitlager@tue.nl"
  start_date: "2024-01-15"
  research_question: "How do incumbent firms involve suppliers in digital innovation processes?"

# Database configuration
database:
  host: "localhost"
  port: 5432
  name: "paper_scanner"
  user: "pdfuser"
  password: "pdfpass"

# Search definition
search:
  name: "Supplier Digital Innovation Review"
  description: "Papers on supplier/vendor involvement in digital innovation and transformation"
  
  # Search string (for documentation) 
  query_definition: 
    - "(vendor* OR supplier* OR partner* OR 'service provider' OR provider*) AND ('digital innovation' OR 'digital strategy' OR 'digital transformation')" 

  # Date range
  date_range:
    from: 2015
    to: 2024
  
  # Databases searched
  databases:
    - scopus
    - web_of_science
    - ieee_xplore

# Import configuration - using local test data
steps:
  - step: Import sample BibTeX files from different sources
    builtin.bibtex_import:
      batch_id: "import_test_20241209"
      imports:
        - name: "Scopus Dataset"
          file_path: "data/bib/scopus.bib"
          source_type: "scopus"
          fix_cite_key: true
          expected_count: 19

        - name: "IEEE Dataset"
          file_path: "data/bib/ieee.bib"
          source_type: "ieee_xplore"
          expected_count: 20
          
        - name: "Web of Science Dataset"
          file_path: "data/bib/wos.bib"
          source_type: "web_of_science"
          expected_count: 20

  - step: "Intermediate message"
    builtin.echo:
      message: "Processing complete - bibtex imported"

  - step: Save checkpoint after import
    builtin.checkpoint:

  - step: Deduplicate papers using multiple matching methods
    builtin.deduplication:
      methods:
        - method: "doi_exact"
          priority: 1
        - method: "title_author_fuzzy"
          priority: 2
          threshold: 0.90
        - method: "title_fuzzy"
          priority: 3
          threshold: 0.95

  - step: Save checkpoint after deduplication
    builtin.checkpoint:

  - step: Categorize and screen papers for quality
    builtin.categorization:
      exclude_types: true
      exclude_reviews: true

  - step: Keyword-based screening
    builtin.keyword_screening:
      # Hard exclusion keywords (if found, exclude immediately)
      exclusion_keywords:
        domains:
          - "medical"
          - "healthcare"
          - "patient"
          - "disease"
          - "clinical"
          - "pharmaceutical"
          - "drug"
        other:
          - "agriculture"
          - "farming"
          - "crop"
          - "education"
          - "classroom"
          - "student"
          - "military"
          - "weapon"
          - "consumer behavior"
          - "retail customer"
      
      # Inclusion keywords (need matches)
      inclusion_keywords:
        innovation:
          - "digital innovation"
          - "digitalization"
          - "digitization"
          - "digital transformation"
          - "technology adoption"
          - "platform"
          - "ecosystem"
        organization:
          - "firm"
          - "company"
          - "organization"
          - "enterprise"
          - "incumbent"
          - "business"
        collaboration:
          - "supplier"
          - "vendor"
          - "partner"
          - "service provider"
          - "provider"
          - "collaboration"
          - "co-creation"

  - step: Semantic screening based on research question
    builtin.semantic_screening:
      model: "all-mpnet-base-v2"
      thresholds:
        auto_include: 0.65
        manual_review: 0.50
        auto_exclude: 0.50

  - step: Save checkpoint after screening
    builtin.checkpoint:

  # - step: Display database statistics and summary
  #   builtin.summarize:
  #     summary: true
  #     tabulate:
  #       - field: paper_type
  #         duplicates: false
  #       - field: journal
  #         duplicates: false

  - step: Display screening results
    builtin.summarize:
      screening: true

  
  # # Expansion configuration (snowballing) 
  # - step: Snowball first selection
  #   builtin.expansion:

  #     # Backward citations 
  #     backward: 
  #       max_iterations: 3 
  #       saturation_threshold: 0.05 # Stop if new papers < 5% of first iteration 
  #       # Reference extraction methods (in priority order) 
  #       sources: 
  #         # - "grobid" 
  #         - "crossref" 
  #         # - "semantic_scholar" 
  #         # - "llm_fallback" 
        
      # # Forward citations 
      # forward: 
      #   min_year: 2023 # Only recent papers 
      #   max_papers_per_source: 100 
      #   sources: 
      #     - "semantic_scholar" 
      #     - "crossref" 
          
      # # Literature review mining 
      # review_mining: 
      #   enabled: true 
      #   description: "Extract references from excluded literature reviews" 
        
  # # PDF download configuration 
  # - step: Download PDFs for selected papers
  #   builtin.pdf_download:
  #     max_concurrent: 5 
  #     timeout_seconds: 30 
  #     retry_attempts: 3 
      
  #   # Sources (in priority order) 
  #     sources: 
  #       - name: "unpaywall" 
  #         enabled: true 
  #         api_key: null # No key needed 
          
  #       - name: "openalex" 
  #         enabled: true 
  #         try_all_locations: true # Try ALL locations, not just best 
          
  #       - name: "semantic_scholar" 
  #         enabled: true 
  #         api_key: null 
          
  #       - name: "pubmed_central" 
  #         enabled: true 
          
  #       - name: "europe_pmc" 
  #         enabled: true 
          
  #       - name: "arxiv" 
  #         enabled: true 
          
  #       - name: "core" 
  #         enabled: true 
  #         api_key: "${CORE_API_KEY}" # Set in environment 
          
  #       - name: "base" enabled: true 
        
  #       - name: "publisher_direct" enabled: true use_institutional_access: true vpn_required: true 
        
  #   # Storage 
  #     storage: 
  #       base_path: "/Users/iheitlager/wc/innovation-review/pdfs" 
  #       organize_by: "year" # or "source" or "flat"

  - step: Export database to JSONL format
    builtin.export:
      format: jsonl
      output_path: "./output/papers_export.jsonl"
      exclude_none: true
      duplicates: false
      overwrite: true

  # - step: Export database to JSONL format
  #   builtin.export:
  #     format: jsonl
  #     output_path: "~/tmp/papers_export_duplicates_only.jsonl"
  #     exclude_none: false
  #     duplicates: only
  #     overwrite: true

  - step: Export database to BibTeX format
    builtin.export:
      format: bibtex
      output_path: "./output/papers_export.bib"
      duplicates: false
      overwrite: true
